<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Facturación</title>
  <link rel="stylesheet" href="caja.component.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
</head>
<body>
  <div class="container">
  <!-- Sidebar -->
  <!-- Sidebar -->
<aside class="sidebar">
  <h1>TodoTech Caja</h1>
  <h2>Cajero: {{currentOrderDetails.seller}}</h2>

  <button *ngFor="let item of menuItems" 
          class="btn" 
          [class.active]="item.active"
          (click)="selectItem(item)">
    <i class="fas {{item.icon}}"></i> {{item.text}}
  </button>

  <button class="btn">
    <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
  </button>

  <h3 class="titulo-ordenes">Órdenes activas</h3>
  <div class="contenedor-tabla-scroll">
    <div class="tabla-ordenes">
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Cliente</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let orden of ordenes">
            <td>{{ orden.id }}</td>
            <td>{{ orden.cliente.nombre }}</td>
            <td>${{ orden.total }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</aside>


 <!-- Order Details -->
<article id="detalle-orden" class="detalle-orden">
  <h2>Detalle de la Orden</h2>
  <form id="form-detalle-orden">
    <div class="form-row">
      <div class="form-group">
        <label for="vendedor">Vendedor:</label>
        <input type="text" id="vendedor" [value]="currentOrderDetails.seller" readonly />
      </div>
      <div class="form-group">
        <label for="cliente">Cliente:</label>
        <input type="text" id="cliente" [value]="currentOrderDetails.client" readonly />
      </div>
    </div>
    
    <div class="form-row">
      <div class="form-group">
        <label for="fecha">Fecha:</label>
        <input type="text" id="fecha" [value]="currentOrderDetails.date" readonly />
      </div>
      <div class="form-group">
        <label for="estado">Estado:</label>
        <input type="text" id="estado" [value]="currentOrderDetails.status" readonly />
      </div>
    </div>
    
    <div class="form-group">
      <label for="metodo-seleccionado">Método de Pago:</label>
      <input type="text" id="metodo-seleccionado" [value]="selectedPaymentMethod" readonly />
    </div>
    
    <div class="resumen-orden">
      <div class="resumen-item">
        <label for="impuestos">Impuestos:</label>
        <input type="text" id="impuestos" [value]="currentOrderDetails.taxes" readonly class="resumen-input" />
      </div>
      <div class="resumen-item">
        <label for="valor-total">Valor Total:</label>
        <input type="text" id="valor-total" [value]="currentOrderDetails.total" readonly class="resumen-input" />
      </div>
      <div class="resumen-item">
        <label for="valor-pagar">Valor a Pagar:</label>
        <input type="text" id="valor-pagar" [value]="currentOrderDetails.toPay" readonly class="resumen-input valor-final" />
      </div>
    </div>
 


      <!-- Payment Methods Section -->
<section class="metodos-pago">
  <h3>Seleccionar Método de Pago</h3>
  <div class="metodos-pago-icons">
    <img src="assets/paypal.png" alt="PayPal" (click)="selectPaymentMethod('PayPal')" [class.active]="selectedPaymentMethod === 'PayPal'" />
    <img src="assets/visa.png" alt="Visa" (click)="selectPaymentMethod('Visa')" [class.active]="selectedPaymentMethod === 'Visa'" />
    <img src="assets/mastercard.png" alt="MasterCard" (click)="selectPaymentMethod('MasterCard')" [class.active]="selectedPaymentMethod === 'MasterCard'" />
    <img src="assets/redcompra.png" alt="RedCompra" (click)="selectPaymentMethod('RedCompra')" [class.active]="selectedPaymentMethod === 'RedCompra'" />
    <img src="assets/visadevito.png" alt="Visa Débito" (click)="selectPaymentMethod('Visa Débito')" [class.active]="selectedPaymentMethod === 'Visa Débito'" />
    <img src="assets/efectivo.png" alt="Efectivo" (click)="selectPaymentMethod('Efectivo')" [class.active]="selectedPaymentMethod === 'Efectivo'" />
  </div>

  <!-- Formulario de tarjeta (existente) -->
  <div class="card-form" *ngIf="showCardForm">
    <!-- ... (mantén tu formulario de tarjeta actual) ... -->
  </div>

 <!-- Sección de efectivo -->
<div class="cash-form" *ngIf="selectedPaymentMethod === 'Efectivo'">
  <div class="form-group">
    <label for="cashAmount" class="form-label">Efectivo recibido ($):</label>
    <input
      type="number"
      id="cashAmount"
      name="cashAmount"
      [(ngModel)]="cashAmount"
      (input)="calculateChange()"
      min="0"
      placeholder="Ingrese monto recibido" />
  </div>

  <!-- Resumen de pago -->
<div class="payment-summary">
  <div class="summary-row">
    <span>Subtotal:</span>
    <span>{{ orden?.total | currency:'COP':'symbol':'1.0-0' }}</span>
  </div>
  <div class="summary-row">
    <span>IVA (19%):</span>
    <span>{{ (orden?.total || 0) * 0.19 | currency:'COP':'symbol':'1.0-0' }}</span>
  </div>
  <div class="summary-row total">
    <span>Total a pagar:</span>
    <span>{{ (orden?.total || 0) * 1.19 | currency:'COP':'symbol':'1.0-0' }}</span>
  </div>
</div>

  <!-- Sección de cambio -->
  <div class="change-section" *ngIf="cashAmount > 0">
    <div class="summary-row">
      <span>Efectivo recibido:</span>
      <span>{{ cashAmount | currency:'COP':'symbol':'1.0-0' }}</span>
    </div>
    <div class="summary-row change" [class.negative]="changeAmount < 0">
      <span>Cambio:</span>
      <span>{{ changeAmount | currency:'COP':'symbol':'1.0-0' }}</span>
    </div>
    
    <div class="alert" *ngIf="changeAmount < 0">
      ¡Faltan {{ (-1 * changeAmount) | currency:'COP':'symbol':'1.0-0' }}!
    </div>
  </div>
</div>
</section>

<!-- Payment Details Section -->
<section class="detalles-pago" *ngIf="showCardForm">
  <h3>Detalles del Pago</h3>
  <div class="form-group">
    <label for="numeroReferencia">Número de tarjeta / referencia</label>
    <input type="text" id="numeroReferencia" placeholder="Ingrese el número" 
           [(ngModel)]="cardDetails.referenceNumber" 
           name="referenceNumber"
           (input)="validateCardForm()" />
  </div>
  <div class="form-group">
    <label for="nombreTitular">Nombre del titular / pagador</label>
    <input type="text" id="nombreTitular" placeholder="Nombre completo" 
           [(ngModel)]="cardDetails.cardName" 
           name="cardName"
           (input)="validateCardForm()" />
  </div>
  <div class="form-group">
    <label for="codigoSeguridad">Código de seguridad / comprobante</label>
    <input type="text" id="codigoSeguridad" placeholder="CVV / Código" 
           [(ngModel)]="cardDetails.securityCode" 
           name="securityCode"
           (input)="validateCardForm()" />
  </div>
  <!-- Campos existentes de la tarjeta -->
  <div class="form-group">
    <label for="cardNumber">Número de Tarjeta</label>
    <input type="text" id="cardNumber" placeholder="1234 5678 9012 3456" 
           [(ngModel)]="cardDetails.cardNumber" 
           name="cardNumber"
           (input)="validateCardForm()" />
  </div>
  <div class="form-group">
    <label for="expiryDate">Fecha de Expiración</label>
    <input type="text" id="expiryDate" placeholder="MM/YY" 
           [(ngModel)]="cardDetails.expiryDate" 
           name="expiryDate"
           (input)="validateCardForm()" />
  </div>
  <div class="form-group">
    <label for="cvv">CVV</label>
    <input type="text" id="cvv" placeholder="123" 
           [(ngModel)]="cardDetails.cvv" 
           name="cvv"
           (input)="validateCardForm()" />
  </div>
</section>

      <!-- Action Buttons -->
      <div class="acciones">
        <button type="button" (click)="cancelOrder()" class="btn-cancelar">
          Cancelar Orden
        </button>
        <button type="button" (click)="processPayment()" class="btn-pagar">
          Procesar Pago
          
        </button>
      </div>
    </form>
  </article>
</div>